(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[18],{rZRf:function(t,e,n){"use strict";n.r(e),n.d(e,"fol_frame_player",(function(){return l}));var i=n("E/yk"),r=n("mudq"),s=n("WKKj"),a=function(t,e,n,i){return new(n||(n=Promise))((function(r,s){function a(t){try{u(i.next(t))}catch(c){s(c)}}function o(t){try{u(i.throw(t))}catch(c){s(c)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,o)}u((i=i.apply(t,e||[])).next())}))},o=function(t,e){var n,i,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(c){s=[6,c],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}};function c(t,e,n){t.addEventListener("message",(function(i){var r=i.data,s=r.id;if("RPC"===r.type&&null!=s)if(r.method){var a=e[r.method];null==a?t.postMessage({type:"RPC",id:s,error:"NO_SUCH_METHOD"}):Promise.resolve().then((function(){return a.apply(null,r.params)})).then((function(e){t.postMessage({type:"RPC",id:s,result:e})})).catch((function(e){t.postMessage({type:"RPC",id:s,error:""+e})}))}else{var o=n[s];if(null==o)throw Error("Unknown callback "+s);delete n[s],r.error?o[1](Error(r.error)):o[0](r.result)}}))}function u(t,e){var n={},i="__xpo"+Math.random().toString().substring(2)+"__";"function"==typeof t&&(t="("+Function.prototype.toString.call(t)+")("+i+")"),t=function(t,e,n){return t=(t=t.replace(/^(\s*)export\s+default\s+/m,(function(t,i){return n.default=!0,""+i+e+".default="}))).replace(/^(\s*)export\s+((?:async\s*)?function(?:\s*\*)?|const|let|var)(\s+)([a-zA-Z$_][a-zA-Z0-9$_]*)/gm,(function(t,i,r,s,a){return n[a]=!0,""+i+e+"."+a+"="+r+s+a})),"var "+e+"={};\n"+t+"\n"+e+";"}(t,i,n)+"\n("+Function.prototype.toString.call(c)+")(self,"+i+",{})";var r,s=URL.createObjectURL(new Blob([t],{type:"text/javascript"})),a=new Worker(s,e),o=a.terminate,u={},h=0;for(r in a.kill=function(t){a.postMessage({type:"KILL",signal:t}),setTimeout(a.terminate)},a.terminate=function(){URL.revokeObjectURL(s),o.call(a)},a.call=function(t,e){return new Promise((function(n,i){var r="rpc"+ ++h;u[r]=[n,i],a.postMessage({type:"RPC",id:r,method:t,params:e})}))},a.rpcMethods={},c(a,a.rpcMethods,u),a.expose=function(t){a[t]=function(){return a.call(t,[].slice.call(arguments))}},n)r in a||a.expose(r);return a}var h=u("\n    export function load(src) {\n       return fetch(src).then(() => src)\n    }\n").load,l=function(){function t(t){var e=this;Object(i.k)(this,t),this.loadComplete=Object(i.f)(this,"loadComplete",7),this.loadProgress=Object(i.f)(this,"loadProgress",7),this.playComplete=Object(i.f)(this,"playComplete",7),this.playProgress=Object(i.f)(this,"playProgress",7),this.frameQueue=[],this.isFirstFrameDrawed=!1,this.isFreezing=!1,this.isLoaded=!1,this.loadAmount=0,this.timeline=0,this.timer=Object(r.e)((function(t){e.step(t)})),this.currentFrame=-1,this.autoload=!1,this.autoplay=!1,this.chunkSize=30,this.fps=30,this.lazyload=!1,this.loop=!1,this.once=!1,this.reverse=!1}return t.prototype.onCurrentFrameChange=function(t){this.playProgress.emit({progress:t,timeline:this.timeline,isReverse:this.reverse});var e=this.frameQueue[t].data;e||this.isFirstFrameDrawed||(e=this.frameQueue[0]&&this.frameQueue[0].data)&&(this.isFirstFrameDrawed=!0),e&&!this.isFreezing&&(this.drawImage(e),this.once&&(this.frameQueue[t].data=null)),Object(s.c)(this.stopIndex)&&this.stopIndex===t&&(this.pause(),this.stopIndex=void 0)},t.prototype.componentDidLoad=function(){var t=this,e="undefined"!==typeof window&&window.devicePixelRatio||1;if(this.canvas.width=this.el.clientWidth*e,this.canvas.height=this.el.clientHeight*e,"OffscreenCanvas"in window){this.canvasOffscreen=this.canvas.transferControlToOffscreen();var n=u('\n        let context;\n        const cache = new Map();\n        self.addEventListener("message", e => {\n          const { canvas, url, width, height } = e.data;\n          if (canvas) {\n            context = canvas.getContext("2d");\n          }\n        \n          if (url && context) {\n            const bitmap = cache.get(url);\n            if (!bitmap) {\n              fetch(url)\n                .then(res => res.blob())\n                .then(blob => createImageBitmap(blob))\n                .then(image => {\n                  context.clearRect(0, 0, width, height);\n                  context.drawImage(image, 0, 0, width, height);\n                  URL.revokeObjectURL(url);\n                  cache.set(url, image);\n                });\n            } else {\n              context.clearRect(0, 0, width, height);\n              context.drawImage(bitmap, 0, 0, width, height);\n            }\n          }\n        });\n      ');n.postMessage({canvas:this.canvasOffscreen},[this.canvasOffscreen]),this.drawImageWorker=n}else this.context=this.canvas.getContext("2d");this.init(),this.loadFirstFrameData(),this.intersectionObserver=new IntersectionObserver((function(e){t.isFreezing=!e[0].isIntersecting}),{threshold:[0]}),this.intersectionObserver.observe(this.el),this.autoload&&this.load(),this.autoplay&&this.play()},t.prototype.componentDidUnload=function(){this.intersectionObserver&&this.intersectionObserver.disconnect()},t.prototype.load=function(){return a(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this.isLoaded=!0,this.loadAmount=0,this.lazyload?[4,this.lazyLoadFrameData()]:[3,2];case 1:return t.sent(),[3,4];case 2:return[4,this.loadAllFrameData()];case 3:t.sent(),t.label=4;case 4:return this.loadComplete.emit(),[2]}}))}))},t.prototype.pause=function(){return a(this,void 0,void 0,(function(){return o(this,(function(t){return this.timer.stop(),[2]}))}))},t.prototype.pin=function(t){return a(this,void 0,void 0,(function(){return o(this,(function(e){return this.currentFrame=t,this.timeline=t/this.fps,this.timer.stop(),[2]}))}))},t.prototype.play=function(t,e){return a(this,void 0,void 0,(function(){return o(this,(function(n){return this.isLoaded||this.load(),Object(s.c)(t)&&Object(s.c)(e)&&(this.reverse=t>e),Object(s.c)(t)&&(this.timeline=t/this.fps),Object(s.c)(e)&&(this.stopIndex=e),this.timer.start(),[2]}))}))},t.prototype.reset=function(){return a(this,void 0,void 0,(function(){return o(this,(function(t){return this.timeline=0,[2]}))}))},t.prototype.stop=function(){return a(this,void 0,void 0,(function(){return o(this,(function(t){return this.pause(),this.reset(),[2]}))}))},t.prototype.drawImage=function(t){var e=this;t&&(this.context?(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.isFirstFrameDrawed?this.context.drawImage(t,0,0,this.canvas.width,this.canvas.height):setTimeout((function(){e.context.drawImage(t,0,0,e.canvas.width,e.canvas.height)}))):this.drawImageWorker.postMessage({url:t.src,width:this.canvas.width,height:this.canvas.height}))},t.prototype.getFrameIndex=function(){return Math.floor(this.timeline*this.fps)},t.prototype.getFrameState=function(t){var e=this.frameQueue.length;return(t%=e)<0&&(t+=e),this.frameQueue[t]},t.prototype.getSubstituteFrameData=function(t){for(var e=t;e>=0;e--){var n=this.getFrameState(t-e);if(n.data)return this.frameQueue[t].data=n.data,n.data}return null},t.prototype.init=function(){var t=this;this.frameQueue=this.imageList.map((function(e,n){return{loadMethod:function(){return a(t,void 0,void 0,(function(){var t,i,r,s,a,c=this;return o(this,(function(o){switch(o.label){case 0:(t=this.frameQueue[n]).status="pending",i=function(e){t.status="complete",c.loadAmount++,c.loadProgress.emit({index:n,success:e,current:c.loadAmount,total:c.imageList.length})},o.label=1;case 1:return o.trys.push([1,5,,6]),"string"!==typeof e?[3,3]:(e=new URL(e,location.href).toString(),[4,h(e)]);case 2:return r=o.sent(),(s=new Image).src=r,t.data=s,[3,4];case 3:t.data=e,o.label=4;case 4:return i(!0),[3,6];case 5:return a=o.sent(),console.error(a),t.data=null,i(!1),[3,6];case 6:return[2]}}))}))},status:"init"}}))},t.prototype.lazyLoadFrameData=function(){return a(this,void 0,void 0,(function(){var t,e,n,i,r,s,a,c,u,h;return o(this,(function(o){switch(o.label){case 0:for(t=Math.ceil(this.frameQueue.length/this.chunkSize),e=new Array(t).fill(!1),n=[],i=t;i>0;){for(r=0;r<e.length;r+=i)e[r]||(n.push(r),e[r]=!0);i=Math.floor(i/2)}s=0,a=n,o.label=1;case 1:if(!(s<a.length))return[3,4];for(c=a[s],u=[],h=c;h<this.frameQueue.length;h+=t)u.push(this.frameQueue[h].loadMethod());return[4,Promise.all(u)];case 2:o.sent(),o.label=3;case 3:return s++,[3,1];case 4:return[2]}}))}))},t.prototype.loadAllFrameData=function(){return Promise.all(this.frameQueue.map((function(t){return t.loadMethod()})))},t.prototype.loadFirstFrameData=function(){var t=this,e=this.frameQueue[0];e&&e.loadMethod().then((function(){t.drawImage(e.data),t.isFirstFrameDrawed=!0}))},t.prototype.step=function(t){var e=this;this.reverse?(this.timeline-=t,this.timeline<0&&(this.timeline=0)):this.timeline+=t;var n=this.getFrameIndex();if(!this.frameQueue[n]||0===n&&this.reverse){var i;if(this.loop&&!this.once?n===this.frameQueue.length?this.timeline=0:0===n&&(this.timeline=(this.frameQueue.length-1)/this.fps):this.timer.stop(),this.once)if(n===this.frameQueue.length?i=this.imageList[n-1]:0===n&&(i=this.imageList[0]),"string"===typeof i){var r=new Image;r.onload=function(){e.el.style.backgroundImage="url("+i+")",e.canvas.remove()},r.src=i}else this.el.style.backgroundImage="url("+i.src+")",this.canvas.remove();this.playComplete.emit()}else this.currentFrame!==n&&(this.currentFrame=n)},t.prototype.render=function(){var t=this;return Object(i.i)(i.b,null,Object(i.i)("canvas",{style:{width:"100%",height:"100%",backgroundColor:"transparent"},ref:function(e){t.canvas=e}}))},Object.defineProperty(t.prototype,"el",{get:function(){return Object(i.h)(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t,"watchers",{get:function(){return{currentFrame:["onCurrentFrameChange"]}},enumerable:!1,configurable:!0}),t}();l.style=":host{display:block;height:300px;background-position:left top;background-size:100% 100%;background-repeat:no-repeat}"}}]);